'use strict';class aa{constructor(a,b,d){this.a=a;this.i=b;this.j=d}bind(a){a.bindTexture(a.TEXTURE_2D,this.a)}};function m(a){for(let b=0;3>b;++b)for(let d=0;3>d;++d)a.m[3*b+d]=b==d?1:0}function t(a,b,d){m(a);a.m[0]=2/(b-0);a.m[2]=-(b+0)/(b-0);a.m[4]=2/(0-d);a.m[5]=-(0+d)/(0-d);a.m[8]=1}function v(a){let b=new w;for(let d=0;3>d;++d)for(let c=0;3>c;++c)b.m[3*c+d]=a.m[3*d+c];return b}
class w{constructor(){this.m=new Float32Array(9);m(this)}multiply(a){let b=new w;for(var d=0;3>d;++d)for(var c=0;3>c;++c)b.m[3*d+c]=0;for(d=0;3>d;++d)for(c=0;3>c;++c)for(let e=0;3>e;++e)b.m[3*d+c]+=this.m[3*d+e]*a.m[3*e+c];return b}translate(a,b){m(this);this.m[2]=a;this.m[5]=b}scale(a,b){m(this);this.m[0]=a;this.m[4]=b}rotate(a){let b=Math.cos(a);a=Math.sin(a);m(this);this.m[0]=b;this.m[1]=-a;this.m[3]=a;this.m[4]=b}clone(){let a=new w;for(let b=0;9>b;++b)a.m[b]=this.m[b];return a}};function x(a,b,d,c,e){let f=a.b;f.uniform2f(a.G,b,d);f.uniform2f(a.I,c,e)}function y(a){var b=a.b;b.useProgram(a.a);b.uniform1i(a.J,0);x(a,0,0,1,1);b=a.b;b.uniform2f(a.f,0,0);b.uniform2f(a.h,1,1);b=new w;a.b.uniformMatrix3fv(a.l,!1,v(b).m)}
class ba{constructor(a,b,d){this.b=a;this.a=null;{let c=this.b;b=this.createShader(b,c.VERTEX_SHADER);d=this.createShader(d,c.FRAGMENT_SHADER);this.a=c.createProgram();c.attachShader(this.a,b);c.attachShader(this.a,d);d=this.b;d.bindAttribLocation(this.a,0,"v");d.bindAttribLocation(this.a,1,"uvp");c.linkProgram(this.a);if(!c.getProgramParameter(this.a,c.LINK_STATUS))throw"Shader error: "+c.getProgramInfoLog(this.a);}this.l=a.getUniformLocation(this.a,"transform");this.s=a.getUniformLocation(this.a,
"color");this.J=a.getUniformLocation(this.a,"t0");this.G=a.getUniformLocation(this.a,"pos");this.I=a.getUniformLocation(this.a,"size");this.f=a.getUniformLocation(this.a,"texPos");this.h=a.getUniformLocation(this.a,"texSize")}createShader(a,b){let d=this.b;b=d.createShader(b);d.shaderSource(b,a);d.compileShader(b);if(!d.getShaderParameter(b,d.COMPILE_STATUS))throw"Shader error:\n"+d.getShaderInfoLog(b);return b}g(a,b,d,c){this.b.uniform4f(this.s,a,b,d,c)}};class z{constructor(a,b){this.x=null==a?0:a;this.y=null==b?0:b}clone(){return new z(this.x,this.y)}};function B(a){if(null!=a.b){a.H||(a.I=a.R.multiply(a.F),a.H=!0);var b=a.b;b.b.uniformMatrix3fv(b.l,!1,v(a.I).m)}}
class ca{constructor(){this.R=new w;this.F=new w;this.I=new w;this.h=new w;this.viewport=new z;this.H=!1;this.b=null;this.l=[]}translate(a,b){this.h.translate(a,b);this.F=this.F.multiply(this.h);this.H=!1}scale(a,b){this.h.scale(a,b);this.F=this.F.multiply(this.h);this.H=!1}rotate(a){this.h.rotate(a);this.F=this.F.multiply(this.h);this.H=!1}push(){this.l.push(this.F.clone());if(64<=this.l.length)throw"Stack overflow!";}pop(){this.F=this.l.pop().clone();this.H=!1;B(this)}};class C{constructor(a,b,d,c){this.h=c.length;this.f=a.createBuffer();this.b=a.createBuffer();this.a=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.f);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.a);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.b);a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),a.STATIC_DRAW)}bind(a){a.bindBuffer(a.ARRAY_BUFFER,this.f);a.vertexAttribPointer(0,2,a.FLOAT,
a.W,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.b);a.vertexAttribPointer(1,2,a.FLOAT,a.W,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.a)}A(a){a.drawElements(a.TRIANGLES,this.h,a.UNSIGNED_SHORT,0)}};function D(a,b,d,c,e){b=null!=b?Math.min(b,32):32;let f=2*Math.PI/32,h,g=[],k=[],l=0,n=!1,p=1;for(let q=0;q<b;++q)d&&++l>=d&&(p=(n=!n)?1+c:1,l-=d),h=f*q,e?(g.push(e*Math.cos(h),e*Math.sin(h),Math.cos(h)*p,Math.sin(h)*p,Math.cos(h+f)*p,Math.sin(h+f)*p),g.push(e*Math.cos(h),e*Math.sin(h),e*Math.cos(h+f),e*Math.sin(h+f),Math.cos(h+f)*p,Math.sin(h+f)*p)):g.push(0,0,Math.cos(h)*p,Math.sin(h)*p,Math.cos(h+f)*p,Math.sin(h+f)*p);b*=3;e&&(b*=2);for(e=0;e<b;++e)k.push(e);return new C(a.a,g,g,k)}
function da(a,b){var d;null==d&&(d=2*Math.PI);let c=d/24;d=[];let e=[],f,h;for(let g=0;24>g;++g)f=b(c*g),h=b(c*(g+1)),d.push(f[0],f[1],h[0],h[1],0,0);for(b=0;72>b;++b)e.push(b);return new C(a.a,d,d,e)}function ha(a){var b=10;var d=2*Math.PI/b;let c=[],e=[],f,h;for(let g=0;g<b;++g)f=0==g%2?1:2,h=0==g%2?2:1,c.push(Math.cos(d*g)*f,Math.sin(d*g)*f,Math.cos(d*(g+1))*h,Math.sin(d*(g+1))*h,0,0);b*=3;for(d=0;d<b;++d)e.push(d);return new C(a.a,c,c,e)}class ia{constructor(a){this.a=a}};function ja(a){let b=new ia(a.a);a.s=[new C(b.a,[0,0,1,0,1,1,0,1],[0,0,1,0,1,1,0,1],[0,1,2,2,3,0]),new C(b.a,[0,0,1,1,0,1],[0,0,1,1,0,1],[0,1,2]),new C(b.a,[0,-1,.71,.71,-.71,.71],[0,0,1,1,0,1],[0,1,2]),D(b),D(b,null,2,.25,.33),da(b,d=>[Math.cos(1.25*(d-Math.PI)/4)*Math.sin(d-Math.PI),Math.cos(d-Math.PI)]),ha(b),D(b,16)]}function ka(a){var b=window.innerWidth,d=window.innerHeight;a.f.width=b;a.f.height=d;a.a.viewport(0,0,b,d);a.i=a.f.width;a.j=a.f.height;a.top=-1;a.left=-a.i/a.j}
function la(a,b,d,c,e,f,h){let g=a.a;null!=c&&x(a.b,c,e,f,h);a.L!=b&&(b.bind(g),a.L=b);null!=d&&d.bind(g);b.A(g)}function H(a,b,d,c,e,f){0>e&&(d-=e);0>f&&(c-=f);la(a,a.s[Math.max(0,Math.min(b|0,a.s.length-1))],null,d,c,e,f)}
function ma(a,b,d,c,e,f,h,g,k,l){let n=a.J.i/16,p=c;let q=f/64,r=h/64;c=d-=b.length/2*(n+e)*q;let E=0;for(let J=0;J<b.length;++J){var u=b.charCodeAt(J);if(10==u)c=d,p+=(n+0)*r;else{null!=g&&(E=Math.sin(l+J*g)*k);var F=a,A=a.J,K=u%16*n;u=(u/16|0)*n;var G=n,ea=n;x(F.b,c,p+E,f,h);{var R=F.b;G/=A.i;ea/=A.j;let fa=R.b;fa.uniform2f(R.f,K/A.i,u/A.j);fa.uniform2f(R.h,G,ea)}la(F,F.s[0],A);c+=(n+e)*q}}}function I(a,b){a.b=b?a.S:a.V;y(a.b);a.g(1,1,1,1);B(a)}function L(a,b){a.G=Math.max(0,Math.min(b,1))}
class na extends ca{constructor(){super();var a=document.createElement("div");a.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1");this.f=document.createElement("canvas");this.f.width=window.innerWidth;this.f.height=window.innerHeight;this.f.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1");a.appendChild(this.f);document.body.appendChild(a);this.a=null;a=this.a=this.f.getContext("webgl",{alpha:!1});if(null===a)throw"Failed to initialize WebGL.";a.activeTexture(a.TEXTURE0);
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(0);a.enableVertexAttribArray(1);ja(this);this.V=new ba(this.a,"\nattribute vec2 v;\nattribute vec2 uvp;\n   \nuniform mat3 transform;\n\nuniform vec2 pos;\nuniform vec2 size;\n\nvarying vec2 uv;\n   \nvoid main() {\n\n    vec3 op = transform * vec3(v * size + pos, 1);\n    gl_Position = vec4(op, 1);\n    uv = uvp;\n}","\nprecision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 color;\n\nuniform vec2 texPos;\nuniform vec2 texSize;\n\nvarying vec2 uv;\n\nvoid main() {\n\n    gl_FragColor = color;\n}\n");
this.b=this.S=new ba(this.a,"\nattribute vec2 v;\nattribute vec2 uvp;\n   \nuniform mat3 transform;\n\nuniform vec2 pos;\nuniform vec2 size;\n\nvarying vec2 uv;\n   \nvoid main() {\n\n    vec3 op = transform * vec3(v * size + pos, 1);\n    gl_Position = vec4(op, 1);\n    uv = uvp;\n}","\nprecision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 color;\n\nuniform vec2 texPos;\nuniform vec2 texSize;\n\nvarying vec2 uv;\n\nvoid main() {\n      \n    const float DELTA = 0.001;\n    vec2 tex = uv;    \n    tex.x *= texSize.x;\n    tex.y *= texSize.y;\n    tex += texPos;\n    vec4 res = color * texture2D(t0, tex);\n    if(res.a <= DELTA) {\n        discard;\n    }\n    gl_FragColor = res;\n}\n");
y(this.b);{a=document.createElement("canvas");a.width=1024;a.height=1024;var b=a.getContext("2d");b.font="56px sans-serif";b.textAlign="center";let e;for(let f=33;123>f;++f){var d=f%16;e=f/16|0;b.fillStyle="#000000";for(var c=-3;3>=c;++c)for(let h=-3;3>=h;++h)if(c!=h||0!=c)for(let g=-2;2>=g;++g)b.fillText(String.fromCharCode(f),64*d+32+g+c,64*e+48+h);b.fillStyle="#FFFFFF";for(c=-2;2>=c;++c)b.fillText(String.fromCharCode(f),64*d+32+c,64*e+48)}b=this.a;d=b.createTexture();b.bindTexture(b.TEXTURE_2D,
d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);a.remove();this.J=new aa(d,1024,1024)}this.L=null;ka(this);this.G=1}clear(a,b,d){let c=this.a;c.clearColor(a,b,d,1);c.clear(c.COLOR_BUFFER_BIT)}g(a,b,d,c){null==a&&(a=1);null==b&&(b=1);null==d&&(d=1);null==c&&(c=1);this.b.g(a,b,d,c*this.G)}};class oa{constructor(){this.keys={};window.addEventListener("keydown",a=>{a.preventDefault();a=a.keyCode;1!=this.keys[a]&&(this.keys[a]=2)});window.addEventListener("keyup",a=>{a.preventDefault();a=a.keyCode;0!=this.keys[a]&&(this.keys[a]=3)})}update(){for(let a in this.keys)2==this.keys[a]?this.keys[a]=1:3==this.keys[a]&&(this.keys[a]=0)}getKey(a){return this.keys[a]|0}};function pa(a,b){a.b+=b-a.l;let d=Math.floor(a.b/a.target)|0,c=0<d;5<d&&(a.b=5*a.target,d=5);for(;0<d--;)null!=a.a&&null!=a.a.update&&a.a.update(a.h),a.h.input.update(),a.b-=a.target;c&&null!=a.a&&null!=a.a.A&&a.a.A(a.f);a.l=b;window.requestAnimationFrame(e=>pa(a,e))}class qa{constructor(){this.s=[];this.a=null;this.l=this.b=0;this.frameRate=30;this.target=0;this.h={X:this,input:new oa};this.f=new na(128,96);window.addEventListener("resize",()=>ka(this.f))}};const ra=[{i:7,j:7,data:[8,1,2,0,1,3,1,0,1,3,2,1,1,3,1,0,2,1,1,0,3,1,4,0,2,1,1,0,1,3,1,0,1,1,1,0,2,1,1,2,1,1,2,0,1,3,8,1]},{i:7,j:7,data:[8,1,1,3,1,7,2,0,1,3,2,1,1,0,1,1,1,3,1,1,1,4,2,1,1,5,4,0,2,1,1,3,2,1,1,4,1,3,2,1,1,0,1,7,1,2,2,0,8,1]},{i:7,j:7,data:[8,1,1,3,1,9,1,0,1,7,1,11,2,1,1,6,1,8,1,5,1,3,1,0,2,1,1,9,1,1,1,8,1,1,1,6,2,1,1,3,1,0,1,10,1,1,1,0,2,1,1,2,2,0,1,8,1,3,8,1]},{i:7,j:7,data:[8,1,1,3,1,11,1,13,2,0,2,1,1,0,1,4,1,9,1,1,1,10,2,1,1,8,1,1,2,0,1,3,2,1,1,3,1,1,1,2,2,0,2,1,1,0,1,8,1,15,1,0,
1,3,8,1]},{i:7,j:7,data:[8,1,1,0,1,3,1,8,1,11,1,3,2,1,1,8,1,9,2,0,1,9,2,1,1,3,1,2,1,5,2,0,2,1,1,4,1,0,1,6,1,14,1,12,2,1,1,10,1,15,1,0,1,1,1,3,8,1]},{i:7,j:7,data:[8,1,1,3,1,11,1,15,1,0,1,3,2,1,1,9,1,0,1,10,1,1,1,0,2,1,1,14,1,8,1,6,1,14,1,4,2,1,1,0,1,8,1,7,1,9,1,0,2,1,1,3,1,5,1,8,1,3,1,2,8,1]},{i:7,j:7,data:[8,1,1,3,1,8,1,3,1,17,1,6,2,1,1,11,1,8,1,0,1,15,1,0,2,1,1,3,1,9,1,0,1,4,1,3,2,1,1,9,1,2,1,1,2,8,2,1,1,15,1,0,1,16,1,0,1,10,8,1]},{i:7,j:7,data:[8,1,1,17,1,10,1,5,1,8,1,3,2,1,1,0,1,15,1,0,1,1,1,
9,2,1,2,8,1,4,1,7,1,12,2,1,1,3,1,8,1,9,1,13,1,0,2,1,1,11,1,16,1,0,1,8,1,2,8,1]},{i:7,j:7,data:[8,1,1,3,1,16,1,8,1,10,1,3,2,1,1,8,1,9,1,7,1,1,1,16,2,1,1,6,1,17,1,0,1,11,1,9,2,1,1,0,1,13,1,0,1,8,1,17,2,1,1,10,1,4,1,2,1,7,1,3,8,1]},{i:7,j:7,data:[8,1,1,17,1,10,1,8,1,5,1,3,2,1,1,6,2,8,1,0,1,7,2,1,1,3,1,19,1,0,1,7,1,4,2,1,1,0,1,18,1,12,1,16,1,0,2,1,1,2,2,0,1,7,1,3,8,1]},{i:7,j:7,data:[8,1,1,17,1,7,1,18,1,7,1,3,2,1,1,3,1,11,1,8,1,4,1,0,2,1,1,4,1,19,1,2,1,5,1,14,2,1,1,10,1,6,1,5,1,8,1,9,2,1,1,3,1,16,1,8,
1,18,1,3,8,1]},{i:8,j:8,data:[9,1,1,11,1,7,1,19,1,0,1,5,1,3,2,1,1,3,1,4,1,5,1,17,1,7,1,18,2,1,1,16,1,0,1,13,1,9,1,8,1,9,2,1,1,8,1,9,1,15,1,1,1,8,1,3,2,1,2,8,1,10,1,0,1,6,1,0,2,1,1,3,1,5,1,0,1,12,1,0,1,2,9,1]}];function M(a,b,d,c,e,f){d=(d+.5)*a.i;a=(c+.5)*a.j+8;e||(b.g(0,0,0,.25),b.push(),b.translate(d+2,a),b.rotate(Math.PI/12),B(b),H(b,3,0,0,26,18),b.pop());b.g(0,0,0);for(c=1;0<=c;--c)0==c&&(e?b.g(...f[0]):b.g(...f[1])),H(b,3,d,a,20+3*c,10+3*c),e||(H(b,0,d-20-3*c,a-16-3*c,2*(20+3*c),16+6*c),0==c&&b.g(...f[2]),H(b,3,d,a-16,20+3*c,10+3*c))}
function sa(a,b,d,c,e,f){a.push();a.translate(b,d);a.rotate(-Math.PI/6);a.scale(c,e);B(a);for(b=1;b>=(f?1:0);--b){f?a.g(...f):1==b?a.g(0,0,0):a.g(1,.9,.2);H(a,3,0,-12,14+3*b,10+3*b);H(a,0,-5-3*b,-8-3*b,10+6*b,32+6*b);for(d=0;2>d;++d)H(a,0,5+3*b,6-3*b+12*d,10,6+6*b);0==b&&(a.g(0,0,0),H(a,3,0,-12,7,5))}a.pop()}function ta(a,b,d,c,e,f){null==e&&(e=1);null==f&&(f=1);c=4+2*Math.sin(c);sa(a,b,d,e,f,[0,0,0,.25]);sa(a,b-c,d-c,e,f)}class ua{constructor(a,b){this.i=a;this.j=b}};const va=[[.9,.95,1],[.6,.8,1],[.05,.25,.6],[.15,.45,.8],[.33,.67,1]],wa=[[1,.9,.95],[1,.6,.8],[.6,.05,.25],[.8,.15,.45],[1,.33,.67]],xa=[[.95,.95,.95],[.8,.8,.8],[.3,.3,.3],[.46,.46,.46],[.67,.67,.67]],ya=[[.8,.15,.45],[.6,.05,.25],[1,.33,.67]],za=[[.33,1,.33],[0,.67,0],[.67,1,.67]];function N(a,b,d){return 0>b||0>d||b>=a.i||d>=a.j?1:a.data[d*a.i+b]}function O(a,b,d,c,e,f){let h=a.B[d*a.i+b];a=N(a,b,d);return null!=c&&4<=a&&7>=a&&c==a-4||e&&0>h?!0:null!=f&&0<f&&16==a?!1:0<h}
function P(a,b,d,c){let e=!1;2==c&&16==N(a,b,d)&&(a.data[d*a.i+b]=0,e=!0);a.B[d*a.i+b]=c;return e}
function Q(a,b,d,c,e,f){let h=[N(a,d-1,c)!=e,N(a,d,c-1)!=e,N(a,d+1,c)!=e,N(a,d,c+1)!=e];b.g(...f[4]);H(b,0,64*d,64*c,64,64);h[2]&&(b.g(...f[2]),H(b,0,64*d+51.2,64*c,12.8,64));h[3]&&(b.g(...f[3]),H(b,0,64*d,64*c+51.2,64,12.8),h[2]&&(b.g(...f[2]),H(b,1,64*d+51.2,64*c+51.2,-12.8,-12.8)));h[0]&&(b.g(...f[0]),H(b,0,64*d,64*c,12.8,64),h[3]&&(b.g(...f[3]),H(b,1,64*d,64*c+51.2,-12.8,12.8)));h[1]&&(b.g(...f[1]),H(b,0,64*d,64*c,64,12.8),h[0]&&(b.g(...f[0]),H(b,1,64*d,64*c,12.8,12.8)),h[2]&&(b.g(...f[2]),H(b,
1,64*d+51.2,64*c,-12.8,12.8)));const g=[0,1,1,0],k=[0,0,1,1],l=[-1,-1,1,1],n=[-1,1,1,-1];let p,q;for(let r=0;4>r;++r)p=g[r],q=k[r],h[r]||h[(r+1)%4]||N(a,d-1+2*p,c-1+2*q)==e||(b.g(...f[r]),H(b,1,64*d+51.2*p,64*c+51.2*q,12.8*l[r],12.8*n[r]),b.g(...f[(r+1)%4]),H(b,1,64*d+51.2*p,64*c+51.2*q,-12.8*l[r],-12.8*n[r]))}
function Aa(a,b,d,c,e){d=64*(d+.5);c=64*(c+.5);b.g(.75,0,1);H(b,0,d-32*e,c-32*e,64*e,64*e);let f;for(let h=0;4>h;++h)f=1-(.25*h+.25*a.h)%1,b.g(.75*f,0,f),H(b,0,d-64*f/2*e,c-64*f/2*e,64*f*e,64*f*e)}
class Ba{constructor(a,b){a=ra[a-1];this.data=Array(a.i*a.j);let d=0;for(let f=0;f<a.data.length-1;f+=2){var c=a.data[f];var e=a.data[f+1];for(let h=0;h<c;++h)this.data[d++]=e}this.i=a.i;this.j=a.j;this.B=Array(a.i*a.j);this.B.fill(0);this.h=0;this.a=30;this.P=new z;this.f=this.M=0;this.b=new ua(64,64);for(a=0;a<this.j;++a)for(e=0;e<this.i;++e)switch(c=N(this,e,a),c){case 1:case 8:case 16:P(this,e,a,1);break;case 2:null==b.w&&(b.w=new Ca(e,a));this.P.x=64*(e+.5);this.P.y=64*(a+.5);break;case 3:P(this,
e,a,-1);c=b;c.h.push(new Da(e,a));++c.N;break;case 12:case 13:case 14:case 15:P(this,e,a,2),b.O.push(new Ea(e,a,c-12))}}update(a,b){a&&(0<this.a&&(this.a-=1*b.step,this.a=Math.max(0,this.a)),this.h=(this.h+.025*b.step)%1);this.M=(this.M+b.step)%60;this.f=(this.f+.05*b.step)%(2*Math.PI)}};function Fa(a,b){if(!a.v)return!0;if(!a.D)return!1;0>=(a.K-=1*b.step)&&(a.D=!1,a.v=!1);return!0}function S(a,b){a.u&&(null==a.o&&(a.C-=b.step),0>=a.C&&(a.C=0,a.u=!1,a.c=a.target.clone()),b=a.C/30,a.a.x=64*(a.c.x*b+(1-b)*a.target.x),a.a.y=64*(a.c.y*b+(1-b)*a.target.y))}
class T{constructor(a,b){this.c=new z(a|0,b|0);this.a=new z(64*a,64*b);this.C=this.depth=0;this.target=this.c.clone();this.u=!1;this.v=!0;this.o=null;this.K=0;this.D=!1}finish(a,b){return U(b)?this.D||!this.v?!0:null!=this.o&&this.o.v||2!=N(a,this.c.x,this.c.y)?!1:(P(a,this.c.x,this.c.y,0),this.K=30,this.D=!0,V(b,this.a.x+32,this.a.y+32,6,10,this.depth,[1,1,1]),!0):!1}};class Da extends T{constructor(a,b){super(a,b);this.b=0;this.depth=this.a.y+32+16}update(a,b){Fa(this,b)||(null!=this.o&&(this.o.D?this.u||(this.c=this.target.clone(),this.target=this.o.target.clone(),this.u=!0,P(a,this.c.x,this.c.y,0)):!this.o.u||this.u||this.c.x==this.o.c.x&&this.c.y==this.o.c.y||2==a.B[this.o.c.y*a.i+this.o.c.x]||(this.target=this.o.c.clone(),this.u=!0,P(a,this.c.x,this.c.y,0),this.o.D||P(a,this.target.x,this.target.y,2)),this.u?(this.C=this.o.D?this.o.K:this.o.C,this.b=(1-this.C/
30)*(this.c.x%2==this.c.y%2==0?1:-1)):P(a,this.c.x,this.c.y,2)),S(this,b),this.depth=this.a.y+32+16)}A(a){const b=[6,3,0],d=[0,0,-2,-6],c=[0,0,-2,-6];var e=[[0,0,0],[.5,.45,.4],[.85,.8,.75],[1,1,1]];const f=[[0,0,0],[.8,.25,.15],[1,.5,.4],[1,.8,.8]];var h=this.a.x+32;let g=this.a.y+32+-8;e=this.o?e:f;if(this.v){this.D&&L(a,this.K/30);a.g(0,0,0,.25);H(a,3,h,g+24,24,8);a.push();a.translate(h,g);a.rotate(Math.sin(this.b*Math.PI)*Math.PI/6);B(a);for(h=0;3>h;++h)a.g(...e[h]),H(a,5,d[h],c[h],22+b[h],22+
b[h]);a.g(...e[3]);H(a,3,d[3],c[3],10,10);a.pop();L(a,1)}}};function Ga(a,b){let d=a.c.x|0,c=a.c.y|0;return O(b,d-1,c,1,null,a.f)&&O(b,d+1,c,3,null,a.f)&&O(b,d,c-1,2,null,a.f)&&O(b,d,c+1,0,null,a.f)}
function Ha(a,b,d,c,e){let f=a.c.x|0,h=a.c.y|0;if(!a.u){a.s=!1;a:{var g=null;var k=N(b,a.c.x,a.c.y);if(4<=k&&7>=k){if(g=new z(a.c.x,a.c.y),g.x+=[0,1,0,-1][k-4],g.y+=[-1,0,1,0][k-4],O(b,g.x,g.y)){k=null;break a}}else{if(10==k||18==k){18==k&&(b.M=60-b.M);for(g=0;g<b.i*b.j;++g)b.data[g]==k||b.data[g]==k+1?b.data[g]=b.data[g]==k?k+1:k:10!=k||2==b.B[g]||8!=b.data[g]&&9!=b.data[g]?18==k&&4<=b.data[g]&&7>=b.data[g]&&(b.data[g]=4+(b.data[g]-4+2)%4):(b.data[g]=8==b.data[g]?9:8,b.B[g]=!b.B[g]);k=null;break a}null!=
c&&17==k&&(b.data[a.c.y*b.i+a.c.x]=0,++a.f,V(c,a.a.x+32,a.a.y+32,4,12,1,[1,1,.5]))}k=g}g=null;null!=k||e?null!=k&&(f=k.x,h=k.y,a.s=!0):1==d.input.getKey(37)?(--f,g=1):1==d.input.getKey(39)?(++f,g=3):1==d.input.getKey(38)?(--h,g=2):1==d.input.getKey(40)&&(++h,g=0);O(b,f,h,g,null,a.f)||f==(a.c.x|0)&&h==(a.c.y|0)||(a.u=!0,a.C=30,a.target.x=f,a.target.y=h,P(b,a.c.x,a.c.y,0),P(b,f,h,2)&&(--a.f,V(c,64*(f+.5),64*(h+.5),5,10,1,[1,1,1])))}}
class Ca extends T{constructor(a,b){super(a,b);this.f=this.h=this.N=this.b=this.l=0;this.s=!1}update(a,b,d){Fa(this,d)||(Ha(this,a,d,b),S(this,d),a=2*Math.PI/30,this.u&&!this.s?(this.b+=a*d.step,this.h+=a*d.step,this.b%=2*Math.PI,this.h%=2*Math.PI,this.l=0):(this.h=this.b=0,this.l+=.05*d.step,this.b%=2*Math.PI),this.depth=this.a.y+32+18)}A(a){var b=Math.PI/16;const d=[.67,.4,.1],c=[[1,.7,0],[.8,.4,0]];if(this.v){var e=this.a.x+32,f=this.a.y+32;this.D&&L(a,this.K/30);a.g(0,0,0,.25);H(a,3,e,f+-2+10+
12,24,7);var h=f+-12+10,g=4*Math.sin(this.h);for(let k=-1;1>=k;k+=2)a.g(0,0,0),H(a,2,e+10*k-1+1,h+g*k,20,-12),a.g(...d),H(a,2,e+10*k,h+g*k,16,-10);a.push();a.translate(e,f+-12+2*Math.sin(this.l));a.rotate(Math.sin(this.b)*b);B(a);a.g(0,0,0);H(a,0,-27,-23,54,46);a.g(...[.9,.9,.9]);H(a,0,-24,-20,48,40);for(b=-1;1>=b;b+=2)a.g(0,0,0),H(a,3,12*b,-6,10,10),a.g(),H(a,3,12*b+2,-8,3,3);for(b=0;2>b;++b)a.g(...c[b]),H(a,1,-16*(1-b),0,-16+32*b,16);a.pop();L(a,1)}}};class Ia{constructor(){this.c=new z;this.speed=new z;this.b=this.a=0;this.h=1;this.f=[1,1,1];this.scale=32;this.depth=0;this.v=!1}update(a){this.v&&(this.speed.y+=.2*a.step,this.speed.y=Math.min(4,this.speed.y),this.a+=this.speed.x/8*.25*a.step,0>=(this.b-=this.h*a.step)&&(this.v=!1),this.c.x+=this.speed.x*a.step,this.c.y+=this.speed.y*a.step)}A(a){this.v&&(a.push(),a.translate(this.c.x,this.c.y),a.rotate(this.a),B(a),a.g(...this.f,this.b/60),H(a,6,0,0,this.scale,this.scale),a.pop())}};function Ja(a,b,d,c,e){var f=Math.PI/16;const h=[-2,-2,2,2][a.b],g=[2,-2,-2,2][a.b];var k=a.u?a.C/30:0;f+=Math.abs(k-.5)/.5*(Math.PI/4-f);k=Math.sin(k*Math.PI)*Math.PI/6;a.c.x%2==a.c.y%2&&(k*=-1);b.push();b.translate(a.a.x+32+d,a.a.y+32+c);b.rotate(k+Math.PI/2*(a.b-1));b.scale(-1,1);B(b);e&&b.g(...e);for(a=1;0<=a;--a)for(e||(0==a?b.g(.8,.67,1):b.g(0,0,0)),d=0;2>d;++d)b.push(),b.rotate(f*(1-2*d)),B(b),1==a&&H(b,0,-27,-3*(1-d),54,3),H(b,7,-24*d-3*a*d,-24*d-3*a*d,24-48*d+3*a*(1-2*d),24-48*d+3*a*(1-2*
d)),b.pop();if(!e)for(e=0;2>e;++e)b.g(0,0,0),H(b,3,-12,10*(-1+2*e),7,7),b.g(),H(b,3,-12+h,10*(-1+2*e)+g,2.5,2.5);b.pop()}
class Ea extends T{constructor(a,b,d){super(a,b);this.b=d;this.o=1}update(a,b,d){this.u&&O(b,this.target.x,this.target.y)&&(this.u=!1,this.target=this.c.clone());this.C=a.C;S(this,d);if(!this.u&&(P(b,this.c.x,this.c.y,2),a.u))a:{a=[0,1,0,-1];d=[-1,0,1,0];var c=[2,3,0,1];let e=this.c.x,f=this.c.y;e+=a[this.b];f+=d[this.b];if(O(b,e,f,null,!0)){c=c[this.b];e=this.c.x+a[c];f=this.c.y+d[c];if(O(b,e,f,null,!0))break a;this.b=c}this.target.x=e;this.target.y=f;this.u=!0;P(b,this.c.x,this.c.y,0)}}A(a){Ja(this,
a,0,0,[0,0,0,.25]);Ja(this,a,-2,-2)}};function V(a,b,d,c,e,f,h){let g=Math.random()*Math.PI*2,k=2*Math.PI/c;for(let A=0;A<c;++A){{let K;var l=a,n=b,p=d,q=4*Math.cos(g),r=4*Math.sin(g)-4,E=e,u=h,F=f;for(let G=0;G<l.a.length;++G)if(!(K=l.a[G]).v){l=K;l.c=new z(n,p);l.speed=new z(q,r);l.a=Math.random()*Math.PI*2;l.b=60;l.h=1;l.f=null==u?[1,1,1]:u;l.scale=E;l.depth=F;l.v=!0;break}}g+=k}}function U(a){return a.w.N==a.N}
function Ka(a){a.b=[];a.b.push(a.w);for(var b=0;b<a.h.length;++b)a.b.push(a.h[b]);for(b=0;b<a.a.length;++b)a.a[b].v&&a.b.push(a.a[b]);a.b.sort((d,c)=>d.depth-c.depth)}
class La{constructor(){this.w=null;this.h=[];this.O=[];this.f=[];this.a=Array(16);for(let a=0;a<this.a.length;++a)this.a[a]=new Ia;this.b=[];this.N=0}update(a,b,d){null!=this.w&&this.w.update(a,this,d);for(let g=0;g<this.h.length;++g){var c=this.h[g],e=this.w,f=this.f,h=a;null==c.o&&c.v&&e.c.x==c.c.x&&e.c.y==c.c.y&&(0!=f.length&&(f[f.length-1].o=c),c.o=e,f.push(c),++e.N,V(this,c.a.x+32,c.a.y+32,5,10,c.depth,[1,.25,.2]),P(h,c.c.x,c.c.y,2))}for(c=this.f.length-1;0<=c;--c)this.f[c].update(a,d);for(c=
0;c<this.O.length;++c)this.O[c].update(this.w,a,d);if(!(c=null==this.w||U(this)&&this.w.finish(a,this))){a:{c=this.w;if(!c.u&&Ga(c,a)&&(Ha(c,a,null,null,!0),Ga(c,a))){c=!0;break a}c=!1}c=!c}if(c){for(b=this.f.length-1;0<=b;--b)this.f[b].finish(a,this);for(a=0;a<this.a.length;++a)this.a[a].update(d)}else W(b,1)}A(a){Ka(this);for(var b=0;b<this.O.length;++b)this.O[b].A(a);for(b=0;b<this.b.length;++b)this.b[b].A(a)}};function Ma(a,b,d,c,e,f,h,g){a.a=b;a.speed=d;a.f.r=c;a.f.U=e;a.f.T=f;a.b=60;null!=h&&(a.s=h);a.l=g?g:0;a.h=a.l;a.active=!0}function X(a){let b=a.b/60;a.a&&(b=1-b);return b}function Na(a){if(.001>=a.l)return 0;let b=a.h/a.l;a.a&&(b=1-b);return b}
class Oa{constructor(){this.b=0;this.s=()=>{};this.f={r:0,U:0,T:0};this.active=!1;this.speed=1;this.a=!1;this.h=0;this.l=1}update(a){this.active&&!(0<(this.h-=1*a.step))&&0>=(this.b-=this.speed*a.step)&&(0==(this.a=!this.a)?(this.s(a),this.b+=60):(this.active=!1,this.b=0))}A(a){!this.active||0<this.h||(a.g(this.f.r,this.f.U,this.f.T,X(this)),H(a,0,0,0,a.viewport.x,a.viewport.y))}};const Y=[.33,.67,1];function W(a,b){Ma(a.a,!0,b?3-b:2,...Y,()=>{Pa(a,2==b?++a.id:0)},30*b);a.l=b}function Pa(a,b){null!=b&&0<b&&(a.id=b);a.f=new La;a.s=new Ba(a.id,a.f)}function Z(a,b,d,c,e){a.push();a.translate(b+16,d+8);a.rotate(e);B(a);a.g(0,0,0,.25);H(a,4,0,0,c,c);a.pop();a.push();a.translate(b,d);a.rotate(e);B(a);a.g(...[.5,.5,.5]);H(a,4,0,0,c,c);a.g(...[.75,.75,.75]);H(a,4,0,0,c-8,c-8);a.pop()}
class Qa{constructor(){this.id=12;Pa(this);this.L=this.h=0;this.a=new Oa;Ma(this.a,!1,1,...Y);this.b=this.G=this.I=this.J=this.l=0}update(a){var b=Math.PI/2/30;this.L+=.05*a.step;var d=this.f;d.w.u||d.w.D||!d.w.v||this.a.active?(b=this.h+b*(this.a.active?-1:1)*a.step,d=Math.PI/2,this.h=0>b?d- -b%d:b%d):this.h=0;this.a.active?(0<this.l&&(this.J=(this.J+.025*a.step)%(2*Math.PI)),this.a.update(a)):(0!=this.b&&0>=(this.G-=a.step)&&(this.G=this.b=0),this.s.update(U(this.f),a),this.f.update(this.s,this,
a),b=this.f,0<b.f.length&&!b.f[0].v?W(this,2):2==a.input.getKey(82)&&W(this))}A(a){var b=Math.PI/3;a.clear(...Y);I(a,!1);var d=1,c=1,e=null,f=null,h=null;this.a.active&&(2==this.l&&this.a.a&&(e=this.s.P.x,f=this.s.P.y,c=8,h=-b*X(this.a)),d=X(this.a),d=1+d*c*.25*(this.a.a?1:-1));b=this.s;c=64*b.j;var g=a.i/a.j*c;t(a.R,g,c);a.viewport.x=g;a.viewport.y=c;a.H=!1;c=64*b.i/2;b=64*b.j/2;g=a.viewport.x/2-c;null!=e&&(c=e);null!=f&&(b=f);a.translate(g,0);a.translate(c,b);null!=h&&a.rotate(h);a.scale(d,d);a.translate(-c,
-b);B(a);d=this.s;b=U(this.f);for(e=0;e<d.j;++e)for(f=0;f<d.i;++f)switch(h=N(d,f,e),h){case 1:Q(d,a,f,e,1,va);break;case 8:Q(d,a,f,e,8,wa);break;case 16:h=a;c=64*(f+.5);g=64*(e+.5);Q(d,h,f,e,-1,xa);h.g(0,0,0);H(h,3,c,g+-8,8,8);H(h,2,c,g+4,12,16);break;default:c=a;g=f;var k=e;g%2==k%2?c.g(.9,.75,.5):c.g(.8,.55,.3);H(c,0,64*g,64*k,64,64);if(2==h){var l=d.a/30;if(b&&0>=l)Aa(d,a,f,e,1);else if(!b||0<l)c=a,g=f,k=e,c.push(),c.translate(64*(g+.5),64*(k+.5)),c.rotate(Math.PI/4),B(c),c.g(.67,0,0),H(c,0,-25.6,
-8,51.2,16),H(c,0,-8,-25.6,16,51.2),c.pop(),Aa(d,a,f,e,1-l)}else if(4<=h&&7>=h){k=d;c=a;l=f;var n=e,p=h-4;g=[[.67,1,.67],[0,.67,0]];c.push();c.translate(64*(l+.5),64*(n+.5));c.rotate(p*Math.PI/2);B(c);k=30>=k.M?0:1;for(l=0;2>l;++l)c.g(...[0,.33,0]),H(c,2,0,-14+26*l,36,14),c.g(...g[(l+k)%2]),H(c,2,0,-14+26*l,24,10);c.pop()}else if(9==h)for(c=a,g=64*f,k=64*e,c.g(.6,.05,.25),l=0;2>l;++l)for(n=0;2>=n;++n)H(c,0,g+24*n,k+56*l,16,8),H(c,0,g+56*l,k+24*n,8,16);else 11==h?M(d.b,a,f,e,!0,ya):19==h&&M(d.b,a,
f,e,!0,za);{var q;c=d;g=a;k=f;l=e;n=[1!=c.B[l*c.i+(k-1)],1!=c.B[(l-1)*c.i+k],1!=c.B[l*c.i+(k+1)],1!=c.B[(l+1)*c.i+k]];g.g(0,0,0,.25);p=1==c.B[(l-1)*c.i+(k-1)];var r=q=0;n[0]?n[1]?p&&H(g,0,64*k,64*l,16,16):(n[0]&&!p&&(q=3),H(g,n[0]&&!p?1:0,64*k-q,3+64*l,-16,-13),H(g,0,64*(k+.25)-q,3+64*l,48+q,13)):(n[1]&&!p&&(r=1,q=3),H(g,0,3+64*k,64*(l+.25)-q,13,48+q),H(g,r,3+64*k,64*l-q,13,16),n[1]||H(g,0,64*(k+.25),64*l,48,16));g.g(0,0,0);n[0]||H(g,0,64*k,64*l,3,64);n[1]||H(g,0,64*k,64*l,64,3);n[2]||H(g,0,64*(k+
1)-3,64*l,3,64);n[3]||H(g,0,64*k,64*(l+1)-3,64,3);r=[0,1,1,0];const E=[0,0,1,1];for(let u=0;4>u;++u)q=r[u],p=E[u],n[u]&&n[(u+1)%4]&&1==c.B[(l-1+2*p)*c.i+(k-1+2*q)]&&H(g,0,64*k+61*q,64*l+61*p,3,3)}10==h?M(d.b,a,f,e,!1,ya):18==h?M(d.b,a,f,e,!1,za):17==h&&ta(a,64*(f+.5),64*(e+.5),d.f+(f+e)*Math.PI*2/d.i)}this.f.A(a);m(a.F);a.H=!1;d=a.i/a.j*720;t(a.R,d,720);a.viewport.x=d;a.viewport.y=720;a.H=!1;B(a);this.a.A(a);if(this.a.active&&0<this.l){d=["STUCK","STAGE CLEAR"][this.l-1];b=[[1,.4,0],[1,1,.5]][this.l-
1];e=a.viewport.y/2;f=a.viewport.x/2-72*(d.length-1)/2;I(a,!0);h=X(this.a);this.a.a&&(h=Na(this.a));c=1/d.length;for(k=0;k<d.length;++k)for(l=(h-c*(this.a.a?k:d.length-1-k))/c,l=Math.max(0,Math.min(l,1)),g=-64+64*l+-16*Math.sin(this.J+k*Math.PI*2/d.length),L(a,l),l=1;0<=l;--l)0==l?a.g(...b):a.g(0,0,0,.25),ma(a,d.charAt(k),f+72*k+8*l,e-48+g+8*l,0,96,96);I(a,!1);L(a,1)}Z(a,0,0,128,this.h);Z(a,a.viewport.x,0,96,-this.h);Z(a,0,a.viewport.y,96,-this.h);Z(a,a.viewport.x,a.viewport.y,128,this.h);d=["STAGE "+
String(this.id),"Password: NONE"];b=[64,48];e=[6,4];f=[Math.PI/3,Math.PI/6];h=[6,4];c=[6,4];I(a,!0);for(l=0;2>l;++l)for(k=2==this.l&&this.a.active?Math.max(X(this.a),Na(this.a))*(e[l]+b[l]):0,n=1;0<=n;--n)g=0==l?36:a.viewport.y-4-32,g-=b[l]/2-n*c[l],g-=(1-2*l)*k,1==n?a.g(0,0,0,.25):a.g(1,1,.5),ma(a,d[l],a.viewport.x/2+n*h[l],g,-16,b[l],b[l],f[l],e[l],this.L);b=a.viewport.y/3;e=this.f.w.f;e!=this.I&&0==this.b&&(this.b=e<this.I?-1:1,this.G=30);this.I=e;if(!(0>=e&&0==this.b)){-1==this.b&&++e;I(a,!1);
d=1;0!=this.b&&(d=this.G/30,1==this.b&&(d=1-d));for(f=0;f<e;++f)L(a,f==e-1?d:1),ta(a,64,b+128*f,0,2,2);L(a,1);I(a,!0)}}};window.onload=()=>{let a=new qa;var b=new Qa(a.f.a);a.s.game=b;a.a=b;a.frameRate=60;a.h.step=60/a.frameRate;a.target=1E3/a.frameRate;pa(a,0)};
