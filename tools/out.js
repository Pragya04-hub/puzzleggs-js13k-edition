'use strict';class k{constructor(a,b,c){this.a=a;this.h=b;this.i=c}bind(a){a.bindTexture(a.TEXTURE_2D,this.a)}};function q(a){for(let b=0;3>b;++b)for(let c=0;3>c;++c)a.f[3*b+c]=b==c?1:0}function u(a,b,c){q(a);a.f[0]=2/(b-0);a.f[2]=-(b+0)/(b-0);a.f[4]=2/(0-c);a.f[5]=-(0+c)/(0-c);a.f[8]=1}function w(a){let b=new x;for(let c=0;3>c;++c)for(let d=0;3>d;++d)b.f[3*d+c]=a.f[3*c+d];return b}
class x{constructor(){this.f=new Float32Array(9);q(this)}multiply(a){let b=new x;for(var c=0;3>c;++c)for(var d=0;3>d;++d)b.f[3*c+d]=0;for(c=0;3>c;++c)for(d=0;3>d;++d)for(let h=0;3>h;++h)b.f[3*c+d]+=this.f[3*c+h]*a.f[3*h+d];return b}clone(){let a=new x;for(let b=0;9>b;++b)a.f[b]=this.f[b];return a}};function y(a,b,c,d,h){let e=a.b;e.uniform2f(a.u,b,c);e.uniform2f(a.v,d,h)}function z(a){var b=a.b;b.useProgram(a.a);b.uniform1i(a.w,0);y(a,0,0,1,1);b=a.b;b.uniform2f(a.c,0,0);b.uniform2f(a.j,1,1);b=new x;a.b.uniformMatrix3fv(a.l,!1,w(b).f)}
class A{constructor(a,b,c){this.b=a;this.a=null;{let d=this.b;b=this.createShader(b,d.VERTEX_SHADER);c=this.createShader(c,d.FRAGMENT_SHADER);this.a=d.createProgram();d.attachShader(this.a,b);d.attachShader(this.a,c);c=this.b;c.bindAttribLocation(this.a,0,"v");c.bindAttribLocation(this.a,1,"uvp");d.linkProgram(this.a);if(!d.getProgramParameter(this.a,d.LINK_STATUS))throw"Shader error: "+d.getProgramInfoLog(this.a);}this.l=a.getUniformLocation(this.a,"transform");this.m=a.getUniformLocation(this.a,
"color");this.w=a.getUniformLocation(this.a,"t0");this.u=a.getUniformLocation(this.a,"pos");this.v=a.getUniformLocation(this.a,"size");this.c=a.getUniformLocation(this.a,"texPos");this.j=a.getUniformLocation(this.a,"texSize")}createShader(a,b){let c=this.b;b=c.createShader(b);c.shaderSource(b,a);c.compileShader(b);if(!c.getShaderParameter(b,c.COMPILE_STATUS))throw"Shader error:\n"+c.getShaderInfoLog(b);return b}g(a,b,c,d){this.b.uniform4f(this.m,a,b,c,d)}};class B{constructor(a,b,c,d){this.j=d.length;this.c=a.createBuffer();this.b=a.createBuffer();this.a=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.c);a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.a);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.b);a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW)}bind(a){a.bindBuffer(a.ARRAY_BUFFER,this.c);a.vertexAttribPointer(0,2,a.FLOAT,
a.F,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.b);a.vertexAttribPointer(1,2,a.FLOAT,a.F,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.a)}s(a){a.drawElements(a.TRIANGLES,this.j,a.UNSIGNED_SHORT,0)}};class C{constructor(a,b){this.x=null==a?0:a;this.a=null==b?0:b}clone(){return new C(this.x,this.a)}};function D(a,b,c){q(a.l);a.o=!1;null!=b&&(a=a.l,q(a),a.f[2]=b,a.f[5]=c)}function E(a){if(null!=a.b){a.o||(a.m=a.A.multiply(a.l.multiply(a.C)),a.o=!0);var b=a.b;b.b.uniformMatrix3fv(b.l,!1,w(a.m).f)}}class F{constructor(){this.A=new x;this.l=new x;this.C=new x;this.m=new x;new x;this.viewport=new C;this.o=!1;this.b=null}};function G(a,b){var c=2*Math.PI/b;let d,h=[],e=[];for(let f=0;f<b;++f)d=c*f,h.push(0,0,Math.cos(d),Math.sin(d),Math.cos(d+c),Math.sin(d+c));for(c=0;c<3*b;++c)e.push(c);return new B(a.a,h,h,e)}class H{constructor(a){this.a=a}};function I(a){var b=window.innerWidth,c=window.innerHeight;a.c.width=b;a.c.height=c;a.a.viewport(0,0,b,c);a.h=a.c.width;a.i=a.c.height;a.top=-1;a.left=-a.h/a.i}function J(a,b,c,d,h,e,f){let g=a.a;null!=d&&y(a.b,d,h,e,f);a.u!=b&&(b.bind(g),a.u=b);null!=c&&c.bind(g);b.s(g)}function K(a,b,c,d,h,e){0>h&&(c-=h);0>e&&(d-=e);J(a,a.w[Math.max(0,Math.min(b|0,a.w.length-1))],null,c,d,h,e)}function N(a,b){a.b=b?a.v:a.D;z(a.b);a.g(1,1,1,1);E(a)}
class O extends F{constructor(){super();var a=document.createElement("div");a.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1");this.c=document.createElement("canvas");this.c.width=window.innerWidth;this.c.height=window.innerHeight;this.c.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1");a.appendChild(this.c);document.body.appendChild(a);this.a=null;a=this.a=this.c.getContext("webgl",{alpha:!1});if(null===a)throw"Failed to initialize WebGL.";a.activeTexture(a.TEXTURE0);
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(0);a.enableVertexAttribArray(1);this.j=new B(this.a,[0,0,1,0,1,1,0,1],[0,0,1,0,1,1,0,1],[0,1,2,2,3,0]);a=new H(this.a);this.j=new B(a.a,[0,0,1,0,1,1,0,1],[0,0,1,0,1,1,0,1],[0,1,2,2,3,0]);this.I=new B(a.a,[0,0,1,1,0,1],[0,0,1,1,0,1],[0,1,2]);this.H=G(a,3);this.G=G(a,32);this.w=[this.j,this.I,this.H,this.G];this.D=new A(this.a,"\nattribute vec2 v;\nattribute vec2 uvp;\n   \nuniform mat3 transform;\n\nuniform vec2 pos;\nuniform vec2 size;\n\nvarying vec2 uv;\n   \nvoid main() {\n\n    vec3 op = transform * vec3(v * size + pos, 1);\n    gl_Position = vec4(op, 1);\n    uv = uvp;\n}",
"\nprecision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 color;\n\nuniform vec2 texPos;\nuniform vec2 texSize;\n\nvarying vec2 uv;\n\nvoid main() {\n\n    gl_FragColor = color;\n}\n");this.b=this.v=new A(this.a,"\nattribute vec2 v;\nattribute vec2 uvp;\n   \nuniform mat3 transform;\n\nuniform vec2 pos;\nuniform vec2 size;\n\nvarying vec2 uv;\n   \nvoid main() {\n\n    vec3 op = transform * vec3(v * size + pos, 1);\n    gl_Position = vec4(op, 1);\n    uv = uvp;\n}","\nprecision mediump float;\n \nuniform sampler2D t0;\nuniform vec4 color;\n\nuniform vec2 texPos;\nuniform vec2 texSize;\n\nvarying vec2 uv;\n\nvoid main() {\n      \n    const float DELTA = 0.001;\n    vec2 tex = uv;    \n    tex.x *= texSize.x;\n    tex.y *= texSize.y;\n    tex += texPos;\n    vec4 res = color * texture2D(t0, tex);\n    if(res.a <= DELTA) {\n        discard;\n    }\n    gl_FragColor = res;\n}\n");
z(this.b);{a=document.createElement("canvas");a.width=1024;a.height=1024;var b=a.getContext("2d");b.font="56px sans-serif";b.textAlign="center";let h;for(let e=0;256>e;++e){var c=e%16;h=e/16|0;b.fillStyle="#000000";for(var d=-1;1>=d;++d)for(let f=-1;1>=f;++f)if(d!=f||0!=d)for(let g=-2;2>=g;++g)b.fillText(String.fromCharCode(e),64*c+32+g+3*d,64*h+48+3*f);b.fillStyle="#FFFFFF";for(d=-2;2>=d;++d)b.fillText(String.fromCharCode(e),64*c+32+d,64*h+48)}b=this.a;c=b.createTexture();b.bindTexture(b.TEXTURE_2D,
c);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);a.remove();this.B=new k(c,1024,1024)}this.u=null;I(this)}clear(a,b,c){let d=this.a;d.clearColor(a,b,c,1);d.clear(d.COLOR_BUFFER_BIT)}g(a,b,c,d){null==a&&(a=1);null==b&&(b=1);null==c&&(c=1);null==d&&(d=1);this.b.g(a,b,c,d)}};class P{constructor(){this.keys={};window.addEventListener("keydown",a=>{a.preventDefault();a=a.keyCode;1!=this.keys[a]&&(this.keys[a]=2)});window.addEventListener("keyup",a=>{a.preventDefault();a=a.keyCode;0!=this.keys[a]&&(this.keys[a]=3)})}update(){for(let a in this.keys)2==this.keys[a]?this.keys[a]=1:3==this.keys[a]&&(this.keys[a]=0)}};function Q(a,b){a.b+=b-a.l;let c=Math.floor(a.b/a.target)|0,d=0<c;5<c&&(a.b=5*a.target,c=5);for(;0<c--;)null!=a.a&&null!=a.a.update&&a.a.update(a.j),a.j.input.update(),a.b-=a.target;d&&null!=a.a&&null!=a.a.s&&a.a.s(a.c);a.l=b;window.requestAnimationFrame(h=>Q(a,h))}class R{constructor(){this.m=[];this.a=null;this.l=this.b=0;this.frameRate=30;this.target=0;this.j={J:this,input:new P};this.c=new O(128,96);window.addEventListener("resize",()=>I(this.c))}};const S=[{h:8,i:8,data:[9,1,1,0,1,1,1,3,3,0,2,1,1,0,2,1,2,0,3,1,4,0,1,3,1,0,2,1,2,0,1,1,1,0,1,1,1,0,2,1,1,0,1,3,4,0,2,1,1,3,1,1,1,0,1,2,1,1,1,3,9,1]}];function T(a,b,c){return 0>b||0>c||b>=a.h||c>=a.i?1:a.data[c*a.h+b]}class U{constructor(a){a=S[a-1];this.data=Array(a.h*a.i);let b,c,d=0;for(let h=0;h<a.data.length-1;h+=2){c=a.data[h];b=a.data[h+1];for(let e=0;e<c;++e)this.data[d++]=b}this.h=a.h;this.i=a.i}};class V{constructor(){this.b=new U(1);this.a=0}update(a){this.a+=a.step}s(a){a.clear(.33,.67,1);N(a,!1);var b=this.b,c=64*b.i,d=a.h/a.i*c;u(a.A,d,c);a.viewport.x=d;a.viewport.a=c;a.o=!1;D(a,a.viewport.x/2-64*b.h/2,0);E(a);b=this.b;for(c=0;c<b.i;++c)for(d=0;d<b.h;++d){var h=T(b,d,c);switch(h){case 1:{h=b;var e=a,f=d,g=c,m=[[.9,.95,1],[.6,.8,1],[.05,.25,.6],[.15,.45,.8],[.33,.67,1]],p=[1!=T(h,f-1,g),1!=T(h,f,g-1),1!=T(h,f+1,g),1!=T(h,f,g+1)];e.g(...m[4]);K(e,0,64*f,64*g,64,64);p[2]&&(e.g(...m[2]),K(e,
0,64*f+51.2,64*g,12.8,64));p[3]&&(e.g(...m[3]),K(e,0,64*f,64*g+51.2,64,12.8),p[2]&&(e.g(...m[2]),K(e,1,64*f+51.2,64*g+51.2,-12.8,-12.8)));p[0]&&(e.g(...m[0]),K(e,0,64*f,64*g,12.8,64),p[3]&&(e.g(...m[3]),K(e,1,64*f,64*g+51.2,-12.8,12.8)));p[1]&&(e.g(...m[1]),K(e,0,64*f,64*g,64,12.8),p[0]&&(e.g(...m[0]),K(e,1,64*f,64*g,12.8,12.8)),p[2]&&(e.g(...m[2]),K(e,1,64*f+51.2,64*g,-12.8,12.8)));var v=[0,1,1,0],t=[0,0,1,1];const L=[-1,-1,1,1],M=[-1,1,1,-1];for(let r=0;4>r;++r){var n=v[r];var l=t[r];p[r]||p[(r+
1)%4]||1==T(h,f-1+2*n,g-1+2*l)||(e.g(...m[r]),K(e,1,64*f+51.2*n,64*g+51.2*l,12.8*L[r],12.8*M[r]),e.g(...m[(r+1)%4]),K(e,1,64*f+51.2*n,64*g+51.2*l,-12.8*L[r],-12.8*M[r]))}}break;default:for(h=b,e=a,f=d,g=c,l=[1!=T(h,f-1,g),1!=T(h,f,g-1),1!=T(h,f+1,g),1!=T(h,f,g+1)],f%2==g%2?e.g(.9,.75,.5):e.g(.8,.55,.3),K(e,0,64*f,64*g,64,64),e.g(0,0,0,.25),n=1==T(h,f-1,g-1),l[0]?l[1]?n&&K(e,0,64*f,64*g,16,16):(K(e,l[0]&&!n?1:0,64*f,64*g,-16,-16),K(e,0,64*(f+.25),64*g,48,16)):(K(e,0,64*f,64*(g+.25),16,48),K(e,l[1]&&
!n?1:0,64*f,64*g,16,16),l[1]||K(e,0,64*(f+.25),64*g,48,16)),e.g(0,0,0),l[0]||K(e,0,64*f,64*g,4,64),l[1]||K(e,0,64*f,64*g,64,4),l[2]||K(e,0,64*(f+1)-4,64*g,4,64),l[3]||K(e,0,64*f,64*(g+1)-4,64,4),p=[0,1,1,0],v=[0,0,1,1],t=0;4>t;++t)m=p[t],n=v[t],l[t]&&l[(t+1)%4]&&1==T(h,f-1+2*m,g-1+2*n)&&K(e,0,64*f+60*m,64*g+60*n,4,4)}}q(a.C);a.o=!1;D(a);b=a.h/a.i*720;u(a.A,b,720);a.viewport.x=b;a.viewport.a=720;a.o=!1;E(a);b="FPS: "+String(60/this.a|0);this.a=0;N(a,!0);a.g(1,1,0);e=a.B.h/16;g=f=0;for(l=0;l<b.length;++l)n=
b.charCodeAt(l),10==n?(f=0,g+=.75*(e+0)):(c=a,d=a.B,h=n%16*e,n=(n/16|0)*e,v=p=e,y(c.b,f,g,48,48),m=c.b,p/=d.h,v/=d.i,t=m.b,t.uniform2f(m.c,h/d.h,n/d.i),t.uniform2f(m.j,p,v),J(c,c.j,d),f+=.75*(e+-20))}};window.onload=()=>{let a=new R;var b=new V(a.c.a);a.m.game=b;a.a=b;a.frameRate=60;a.j.step=60/a.frameRate;a.target=1E3/a.frameRate;Q(a,0)};
